<!DOCTYPE html>

<html lang="ja">
<head>


    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="cleartype" content="on"/>
    <meta name="robots" content="noindex,nofollow,noarchive"/>
    <link rel="shortcut icon" href="https://image.asoview-media.com/image/production/fundamentals/logo/favicon.ico"/>

    <title wovn-ignore="">使用画面／超特割！【最大10%割引】新江ノ島水族館　前売り入場チケット（※特別補助入り）※4月28日まで有効（3/27購入）｜アソビュー！</title>


    <!-- Google Tag Manager -->
    <script>
        /*<![CDATA[*/
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-MZQ64L7');
        /*]]>*/
    </script>
    <!-- End Google Tag Manager -->


    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link rel="stylesheet" href="css/page2.css"/>
</head>
<body>


<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZQ64L7" height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->


<header class="header">
    <div class="header__main-header">
        <div class="header__control-wrap">
            <input type="hidden" data-property="history-url" value="https://www.asoview.com/member/booking/"/>
            <a href="index.html" class="header__control"
               data-asv-do="open-drawer" onclick="ga('send', 'event', 'header', 'click', 'menu_SP');">
                <div onclick="history.back()" class="header__control-label">戻る</div>
            </a>
        </div>
        <h1 class="header__logo-wrap">
            <a href="https://www.asoview.com/" class="header__logo">アソビュー！</a>
        </h1>
        <div class="header__item">
        </div>
    </div>
</header>

<div class="layout-wrap">
    <div class="ticket blur">
        <figure class="ticket__image-wrap">
            <img class="ticket__image" src="img/d1d08fe8-8df0-41e3-baea-4af56bd7beb2.jpeg" alt=""/>
        </figure>
        <div class="ticket__inner-contents-wrap">
            <div class="ticket__inner-contents">

                <div class="ticket__ticket-detail ">
                    <div class="ticket__ticket-name">
                        <b>超特割！【最大10%割引】新江ノ島水族館　前売り入場チケット（※特別補助入り）※4月28日まで有効</b>
                        <br/>

                    </div>
                    <dl class="ticket__ticket-data">
                        <dt class="ticket__data-title">チケットブックID：</dt>
                        <dd class="ticket__data-item ticket__data-item--book-id" id="masterCode" wovn-ignore="">253298SN0418</dd>
                    </dl>

                    <dl class="ticket__ticket-data">
                        <dt class="ticket__data-title">チケット利用枚数：</dt>
                        <dd class="ticket__data-item">
                            <span class="ticket__use-ticket-types">大人1枚</span>
                            <em class="ticket__total-number">合計<span class="ticket__number"
                                                                     wovn-ignore="">1</span>枚</em>
                        </dd>
                    </dl>
                </div>

                <div class="ticket-papers-viewport unblur">
                    <div class="ticket-papers-container">
                        <div id="flip" class="ticket-papers">
                            <div class="ticket-paper flip-paper front">
                                <div class="ticket__use-those-ticket">
                                    <b class="ticket__attention">スタッフ操作画面</b>
                                    <strong class="ticket__attention-description">この画面は<br/>必ずスタッフに操作してもらってください</strong>
                                    <small class="ticket__authentication-code">確認用コード:<span id="randomCode2" wovn-ignore="">5602</span>
                                    </small>
                                </div>
                            </div>
                            <!--<div class="ticket-paper-back flip-paper back">-->
                            <!--<div class="veil">-->
                            <!--裏-->
                            <!--</div>-->
                            <!--</div>-->
                            <div class="after-used-paper flip-paper front">
                                <div class="used-ticket">
                                    <dl class="used-ticket__use-data">
                                        <dt class="used-ticket__title">チケット利用日：</dt>
                                        <dd class="used-ticket__item">
                                            <time class="used-ticket__use-data-day"></time>
                                        </dd>
                                    </dl>
                                    <small class="used-ticket__authentication-code">確認用コード:<span id="randomCode1"
                                            wovn-ignore="">5602</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="passcode-contents">
        <form class="passcode-contents__form" data-model="form" method="post" id="ticketItem">
            <input type="hidden" data-property="twist-off-api-url"
                   value="https://ticket-guest.asoview.com/api/twist/off"/>
            <input type="hidden" data-property="ticketBookCode" value="153298SN0418"/>

            <input type="hidden" id="randomCode.value" name="randomCode.value" value="5610"/>
            <ul data-model="selected-tickets" style="visibility: hidden">
                <li>
                    <input type="hidden" class="category-name" data-category-name="大人" value="大人"/>
                    <input type="hidden" class="input-count" data-input-count="1" value="1"/>
                    <input type="hidden" class="valid-count" data-valid-count="2" value="2"/>
                    <input type="hidden" class="used-count" data-used-count="0" value="0"/>
                </li>
            </ul>
            <i class="passcode-contents__text">パスコードを入力してください。</i>
            <div class="passcode-contents__error-text">
                <small class="passcode-contents__error-text--error"> </small>
            </div>
            <input class="passcode-contents__password" type="password" name="ninsyou" wovn-ignore=""
                   data-property="passCode"/>
            <input type="hidden" name="ticketTypeId" value="null"/>
            <div class="passcode-contents__button-wrap">
                <button type="button" class="passcode-contents__cancel">キャンセル</button>
                <button type="button" class="passcode-contents__agree">OK</button>
            </div>
        </form>
    </div>

    <div class="ticket-vell show display-none"></div>

    <ul class="step-navi">
        <li class="step-navi__item step-navi__item--fixed">チケット選択</li>
        <li class="step-navi__item step-navi__item--active">枚数確認</li>
        <li class="step-navi__item step-navi__item--next">確認（スタッフ）</li>
    </ul>

    <div class="attention-alert display-none">
        <div class="attention-alert__inner">
            <strong class="attention-alert__attention">次の画面をそのままスタッフに<br/>ご提示ください</strong>
            <small class="attention-alert__text">間違えてお客様自身で使用済みにしてしまった場合、返金ができません。</small>
            <div class="attention-alert__button-wrap">
                <button onclick="history.back()" class="attention-alert__cancel">戻る</button>
                <button  id="agreeBtn" onclick="agreeConfirm()" class=" attention-alert__agree">表示する</button>
            </div>
        </div>
    </div>

    <div class="ticket-detail display-none">
        <b class="ticket-detail__ticket-name">超特割！【最大10%割引】新江ノ島水族館　前売り入場チケット（※特別補助入り）※4月28日まで有効</b>


        <table class="ticket-detail__breakdown">
            <caption class="ticket-detail__heading">チケット内訳</caption>

            <tr>
                <th class="ticket-detail__type">大人</th>
                <td class="ticket-detail__number">1枚</td>
            </tr>


            <tr>
                <td class="ticket-detail__total-ticket" colspan="2">合計1枚</td>
            </tr>
        </table>


    </div>
</div>

<!--<script src="js/unused-7dbf0d077b8cd23ba4dab8dc6348d60e.js"></script>-->
<script src="js/jquery.min.js"></script>
<script src="js/turn.js"></script>
<script>

    //  首先验证是否是已经用过票
    let masterkey=$('#masterCode').html();
    let target=localStorage.getItem('ticketFlagGoldKey');
    if(target&&target===masterkey){
    //    现实已经使用
        let  time= localStorage.getItem('ticketFlagValue2');
        let num=localStorage.getItem('ticketFlagValue');
        $('.used-ticket__use-data-day').html(time);
        $('#randomCode1,#randomCode2').html(num);
        $('.ticket__use-those-ticket').css('display','none')
        $('.ticket__inner-contents').addClass('used');
        agreeConfirm();
    }else{

    /*等候两三秒*/
    //1.first disable btn
    $('#agreeBtn').addClass('disabled').attr('disabled',true);

    //release  after 2500ms
    setTimeout(()=>{
        $('#agreeBtn').removeClass('disabled').attr('disabled',false);
    },2500)

    var turnWidth = $('#flip').outerWidth(),
        turnHeight = $('#flip').outerHeight();
    $("#flip").turn({
        width: turnWidth,
        height: turnHeight,
        display: 'single',
        inclination: 50,
        autoCenter: true,
    });

    $("#flip").turn('peel', 'tr');
    //  绑定结束事件
    $("#flip").bind('turned',
        function (event, page, obj) {
            $('.ticket__inner-contents').addClass('used');
            //获取当前日期
            var myDate = new Date;
            var year = myDate.getFullYear(); //获取当前年
            var mon = myDate.getMonth() + 1; //获取当前月
            var date = myDate.getDate(); //获取当前日
            var h = myDate.getHours();//获取当前小时数(0-23)
            var m = myDate.getMinutes();//获取当前分钟数(0-59)
            $('.used-ticket__use-data-day').html(year + "年" + mon + "月" + date + "日 " +h+':'+m);
            // $('.used-ticket__use-data-day').text();
            //  销毁
            $("#flip").turn('disable');

            //票的信息存进 浏览器
            localStorage.setItem('ticketFlagGoldKey',$('#masterCode').html());
            localStorage.setItem('ticketFlagValue',$('#randomCode1,#randomCode2').html());
            localStorage.setItem('ticketFlagValue2',  $('.used-ticket__use-data-day').html());

        })

    //action end
    $("#flip").bind('end',
        function (event, page, obj) {
            $("#flip").turn('peel', 'tr');
            // console.log('票撕了',event, page, obj);
            // //  销毁
            // // $("#flip").turn('disable');
        })
   var num=rand(1000,9999);
    $('#randomCode1,#randomCode2').html(num)
    }
    //  确认
    function agreeConfirm() {
        console.log('点机了事件')
        $('.display-none').css('display', 'none')
        $('.ticket').removeClass('blur')
        $('.step-navi').css('display','none')
    }
    //生成随机数
    function rand(min,max) {
        return Math.floor(Math.random()*(max-min))+min;
    }
</script>
</body>
<style>
    .flipbook .page {
        background: transparent;
    }

    /*..page设置background-color可以设置翻页底色，默认为Transparent。*/
</style>
</html>
